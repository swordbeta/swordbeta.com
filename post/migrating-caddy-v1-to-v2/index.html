<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=author content="Michael van Tricht"><meta name=description content="I like using Caddy for automatic SSL certificates using Let&rsquo;s Encrypt. With a few configuration lines you can get up and running in no time.
Recently I switched VPS providers and ended up having to migrate Caddy from v1 to v2. The documentation for Caddy is wonderful and chockful with emojis. The getting started tutorial starts by telling you how a Caddyfile looks like in v2, where my confusion started. As I mostly need reverse proxies, the very first example there looks like this:"><meta name=keywords content="blog,developer,personal,resume"><meta name=twitter:card content="summary"><meta name=twitter:title content="Migrating Caddy v1 to v2 using Caddyfile"><meta name=twitter:description content="I like using Caddy for automatic SSL certificates using Let&rsquo;s Encrypt. With a few configuration lines you can get up and running in no time.
Recently I switched VPS providers and ended up having to migrate Caddy from v1 to v2. The documentation for Caddy is wonderful and chockful with emojis. The getting started tutorial starts by telling you how a Caddyfile looks like in v2, where my confusion started. As I mostly need reverse proxies, the very first example there looks like this:"><meta property="og:title" content="Migrating Caddy v1 to v2 using Caddyfile"><meta property="og:description" content="I like using Caddy for automatic SSL certificates using Let&rsquo;s Encrypt. With a few configuration lines you can get up and running in no time.
Recently I switched VPS providers and ended up having to migrate Caddy from v1 to v2. The documentation for Caddy is wonderful and chockful with emojis. The getting started tutorial starts by telling you how a Caddyfile looks like in v2, where my confusion started. As I mostly need reverse proxies, the very first example there looks like this:"><meta property="og:type" content="article"><meta property="og:url" content="https://tricht.dev/post/migrating-caddy-v1-to-v2/"><meta property="article:published_time" content="2021-04-03T13:24:32+02:00"><meta property="article:modified_time" content="2021-04-03T13:24:32+02:00"><base href=https://tricht.dev/post/migrating-caddy-v1-to-v2/><title>Migrating Caddy v1 to v2 using Caddyfile Â· Michael van Tricht</title><link rel=canonical href=https://tricht.dev/post/migrating-caddy-v1-to-v2/><link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel=stylesheet><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.13.0/css/all.css integrity=sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><link rel=stylesheet href=/css/coder.min.fce3d3684e836ce340cdd591dad1749c310472d5ed4049fab99845c9aec4d4bf.css integrity="sha256-/OPTaE6DbONAzdWR2tF0nDEEctXtQEn6uZhFya7E1L8=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.717236c74e0a5208ef73964a9f44c6b443b689a95b270d8b2a40d0c012460dac.css integrity="sha256-cXI2x04KUgjvc5ZKn0TGtEO2ialbJw2LKkDQwBJGDaw=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/extra.css><link rel=icon type=image/png href=https://tricht.dev/images/favicon.ico sizes=32x32><link rel=icon type=image/png href=https://tricht.dev/images/favicon.ico sizes=16x16><link rel=apple-touch-icon href=https://tricht.dev/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=https://tricht.dev/images/apple-touch-icon.png><meta name=generator content="Hugo 0.74.3"></head><body class=colorscheme-dark><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Michael van Tricht</a>
<span id=dark-mode-toggle class=float-right><i class="fas fa-adjust fa-fw"></i></span><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fas fa-bars fa-fw"></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://tricht.dev/about/>About</a></li><li class=navigation-item><a class=navigation-link href=https://tricht.dev/post/>Blog</a></li><li class="navigation-item separator"><span>|</span></li></ul></section></nav><div class=content><section class="container page"><article><header><h1>Migrating Caddy v1 to v2 using Caddyfile</h1></header><p>I like using <a href=https://caddyserver.com/>Caddy</a> for automatic SSL certificates using <a href=https://letsencrypt.org/>Let&rsquo;s Encrypt</a>.
With a few configuration lines you can get up and running in no time.</p><p>Recently I switched VPS providers and ended up having to migrate Caddy from v1 to v2. The documentation for Caddy is wonderful and chockful with emojis. The <a href=https://caddyserver.com/docs/getting-started#your-first-caddyfile>getting started</a> tutorial starts by telling you how a Caddyfile looks like in v2, where my confusion started. As I mostly need reverse proxies, the very first example there looks like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>localhost

reverse_proxy 127.0.0.1:9000
</code></pre></div><p>which quite frankly looks quite different than what it looked like in v1. No curly brackets. How do I define multiple domains? Well apparently, the above is the equivalent to</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>localhost {
  reverse_proxy 127.0.0.1:9000
}
</code></pre></div><p>which is sorta what you&rsquo;re used to! They do mention this somewhere <a href=https://caddyserver.com/docs/caddyfile-tutorial#multiple-sites>else</a> but it is not mentioned in the <a href=https://caddyserver.com/docs/v2-upgrade>v2 upgrade guide</a>.</p><p>So to help you, here&rsquo;s my v1 Caddyfile:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>subdomain1.tricht.dev {
  proxy / localhost:7777
}
subdomain2.tricht.dev {
  proxy /notifications/hub/negotiate localhost:8081 {
    transparent
  }
  proxy /notifications/hub localhost:3012 {
    websocket
  }
  proxy / localhost:8081 {
    transparent
  }
}
subdomain3.tricht.dev {
  proxy / localhost:8080 {
    transparent
  }
  limits {
    header 64kb
    body 1gb
  }
  header / {
    Strict-Transport-Security &#34;max-age=31536000; includeSubdomains; preload&#34;
    X-XSS-Protection &#34;1; mode=block;&#34;
    X-Content-Type-Options &#34;nosniff&#34;
    X-Frame-Options &#34;SAMEORIGIN&#34;
  }
  gzip {
    ext *
    level 4
  }
}
</code></pre></div><p>and what it looks like in v2:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>subdomain1.tricht.dev {
  reverse_proxy localhost:7777
}
subdomain2.tricht.dev {
  reverse_proxy /notifications/hub/negotiate localhost:8081
  reverse_proxy /notifications/hub localhost:3012
  reverse_proxy localhost:8081
}
subdomain3.tricht.dev {
  reverse_proxy localhost:8080
  header {
    Strict-Transport-Security &#34;max-age=31536000; includeSubdomains; preload&#34;
    X-XSS-Protection &#34;1; mode=block;&#34;
    X-Content-Type-Options &#34;nosniff&#34;
    X-Frame-Options &#34;SAMEORIGIN&#34;
  }
  encode gzip {
    gzip 4
  }
}
</code></pre></div><p>So not much has changed, except a missing <code>limits</code> directive and confusing documentation.</p></article></section></div><footer class=footer><section class=container></section></footer></main><script src=/js/dark-mode.min.0213e1773e6d1c5a644f847c67a6f8abac49a3776e2976f6008038af8c5b76a1.js></script><script>(function(f,a,t,h,o,m){a[h]=a[h]||function(){(a[h].q=a[h].q||[]).push(arguments)};o=f.createElement('script'),m=f.getElementsByTagName('script')[0];o.async=1;o.src=t;o.id='fathom-script';m.parentNode.insertBefore(o,m)})(document,window,'//analytics.tricht.dev/tracker.js','fathom');fathom('set','siteId','TMBWC');fathom('trackPageview');</script></body></html>